var N=Object.defineProperty;var R=(r,t,e)=>t in r?N(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(R(r,typeof t!="symbol"?t+"":t,e),e);import{d as D,r as T,o as B,h as m,c as p,a as l,t as G,u as b,F as k,b as F,n as C,e as y,f as I}from"./vendor.97a7e87d.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}};$();class H{constructor(t,e){this.width=t,this.height=e}isCollision(t){const e=t.x<0||t.y<0||t.x>=this.width||t.y>=this.height;return e&&console.error("\u649E\u5899\u4E86"),e}}class d{constructor(){o(this,"x",0);o(this,"y",0)}static create(t,e){const s=new d;return s.x=t,s.y=e,s}}function S(r,t,e){let s=0,n=0;i();function i(){s=Math.floor(Math.random()*r),n=Math.floor(Math.random()*t);for(let c=0;c<e.length;c++)if(s===e[c].x&&n===e[c].y){i();break}}return d.create(s,n)}class M extends d{constructor(t){super();this.game=t}getRandomPoint(){const{game:t}=this,e=t.forbiddenPoints;return S(t.map.width,t.map.height,e)}}class _ extends M{constructor(){super(...arguments);o(this,"type","food")}produce(){const t=this.getRandomPoint();this.x=t.x,this.y=t.y}consume(){return this.game.snake.grow(this.x,this.y),this.game.count++,!0}}class U{constructor(){o(this,"obstacles",[])}add(t){this.obstacles.push(t)}isCollision(t){return this.obstacles.filter(e=>e.x===t.x&&e.y===t.y)}init(){this.obstacles.forEach(t=>t.produce())}}class g extends d{static create(t,e){const s=new g;return s.x=t,s.y=e,s}}class W{constructor(){o(this,"body")}get head(){return this.body[0]}get size(){return this.body.length}init(t){this.body=[];for(let e=0;e<t;e++)this.prepend(g.create(e,0))}getNextPosition(t){const{head:e}=this,s=new d;return s.x=e.x+t.x,s.y=e.y+t.y,s}grow(t,e){this.append(g.create(t,e))}reduce(){this.body.pop()}append(t){this.body.push(t)}prepend(t){this.body.unshift(t)}isCollision(t){for(let e=0;e<this.body.length;e++){const s=this.body[e];if(s.x===t.x&&s.y===t.y)return console.error("\u649E\u81EA\u5DF1\u4E86"),!0}return!1}move(t){this.prepend(g.create(t.x,t.y)),this.body.pop()}}const u=class extends d{static create(t,e){const s=new u;return s.x=t,s.y=e,s}};let a=u;o(a,"UP",u.create(0,-1)),o(a,"DOWN",u.create(0,1)),o(a,"LEFT",u.create(-1,0)),o(a,"RIGHT",u.create(1,0)),o(a,"LEFT_UP",u.create(-1,-1)),o(a,"RIGHT_UP",u.create(1,-1)),o(a,"LEFT_DOWN",u.create(-1,1)),o(a,"RIGHT_DOWN",u.create(1,1));class z{constructor(t){o(this,"obstacleManager",new U);o(this,"snake");o(this,"map");o(this,"direction");o(this,"count");o(this,"config");this.config=t,this.snake=new W,this.map=new H(this.config.map.width,this.config.map.height)}get forbiddenPoints(){return[...this.body,...this.obstacles]}get obstacles(){return this.obstacleManager.obstacles.map(t=>({x:t.x,y:t.y,type:t.type}))}get body(){return this.snake.body.map(t=>d.create(t.x,t.y))}get score(){return this.count}addObstacle(t){this.obstacleManager.add(t)}setDirection(t){this.direction.x+t.x===0&&this.direction.y+t.y===0||(this.direction=t)}init(){this.count=0,this.snake.init(this.config.snake.bodyLength),this.direction=a.RIGHT,this.obstacles.length===0&&this.addObstacle(new _(this)),this.obstacleManager.init()}update(){const t=this.snake.getNextPosition(this.direction);if(this.map.isCollision(t)||this.snake.isCollision(t))return!1;const e=this.obstacleManager.isCollision(t);return e.map(s=>s.consume()).filter(s=>!s).length>0?!1:(e.forEach(s=>s.produce()),this.snake.move(t),!0)}}const q={style:{"text-align":"center"}},K=l("section",null,[l("p",null,"\u952E\u76D8 w a s d \u63A7\u5236\u79FB\u52A8"),l("p",null,"\u86C7\u5934\u9ED1\u8272\uFF0C\u86C7\u8EAB\u84DD\u8272"),l("p",null,"\u7EFF\u8272\u662F\u98DF\u7269\uFF0C\u9EC4\u8272\u4E3A\u70B8\u5F39")],-1),V=D({setup(r){const t=new z({map:{width:20,height:20},snake:{bodyLength:3}});class e extends M{constructor(){super(...arguments);o(this,"type","bomb")}produce(){const w=this.getRandomPoint();this.x=w.x,this.y=w.y}consume(){return this.game.count>3&&(this.game.snake.reduce(),this.game.count--),!0}}t.addObstacle(new _(t)),t.addObstacle(new e(t)),t.init(),window.game=t;const{width:s,height:n}=t.map,i=new Array(s*n),c=T({body:[],obstacles:[]});let x=!0;const A=()=>{t.init(),x=!0};console.log(t);const E=function(){t.setDirection(a.UP)},v=function(){t.setDirection(a.LEFT)},O=function(){t.setDirection(a.DOWN)},P=function(){t.setDirection(a.RIGHT)};return B(()=>{setInterval(()=>{if(!x)return;t.update()||(x=!1),c.body=t.body,c.obstacles=t.obstacles},200),m("w",E),m("a",v),m("s",O),m("d",P)}),(L,w)=>(y(),p("div",q,[l("h1",null,"\u5F97\u5206\uFF1A"+G(b(t).count),1),l("div",{style:C({position:"relative",display:"flex",flexWrap:"wrap",width:`${b(s)*20}px`,height:`${b(n)*20}px`,margin:"0 auto"})},[(y(!0),p(k,null,F(b(i),(h,f)=>(y(),p("div",{key:f,style:{width:"20px",border:"1px solid #ccc","box-sizing":"border-box"}}))),128)),(y(!0),p(k,null,F(b(c).body,(h,f)=>(y(),p("div",{key:f,style:C({position:"absolute",width:"20px",height:"20px",left:`${h.x*20}px`,top:`${h.y*20}px`,backgroundColor:f===0?"black":"blue"})},null,4))),128)),(y(!0),p(k,null,F(b(t).obstacles,(h,f)=>(y(),p("div",{key:f,style:C({position:"absolute",width:"20px",height:" 20px",left:`${h.x*20}px`,top:`${h.y*20}px`,backgroundColor:h.type==="food"?"green":"yellow"})},null,4))),128))],4),l("button",{style:{"margin-top":"16px"},class:"btn",onClick:E},"w"),l("div",null,[l("button",{class:"btn",onClick:v},"a"),l("button",{class:"btn",onClick:O},"s"),l("button",{class:"btn",onClick:P},"d")]),l("button",{class:"btn",onClick:A},"restart"),K]))}});I(V).mount("#app");
